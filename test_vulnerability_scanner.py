import unittest
from unittest.mock import patch, MagicMock

from vulnerability_scanner import VulnerabilityScanner

class TestVulnerabilityScanner(unittest.TestCase):
    def setUp(self):
        self.scanner = VulnerabilityScanner(cvss_threshold=5.0)

    @patch("modules.vulnerability_scanner.requests.get")
    def test_query_nvd_keyword(self, mock_get):
        mock_response = MagicMock()
        mock_response.json.return_value = {
            "vulnerabilities": [
                {
                    "cve": {"id": "CVE-2023-0001"},
                    "metrics": {
                        "cvssMetricV31": [
                            {"cvssData": {"baseScore": 7.5, "baseSeverity": "HIGH"}}
                        ]
                    }
                }
            ]
        }
        mock_response.status_code = 200
        mock_get.return_value = mock_response

        result = self.scanner.query_nvd("example")
        self.assertEqual(len(result), 1)
        self.assertEqual(result[0]["cve"]["id"], "CVE-2023-0001")

if __name__ == "__main__":
    unittest.main()